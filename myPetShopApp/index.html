<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í«ìƒµ ì¬ê³ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        /* CSS: ì§ê´€ì ì¸ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ */
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f7f9fc; display: flex; justify-content: center; padding: 20px; margin: 0; }
        .app-container { width: 100%; max-width: 450px; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-top: 20px; }
        h1 { text-align: center; color: #333; font-size: 22px; margin-bottom: 20px; }
        
        .input-card { background: #fdfdfd; padding: 20px; border: 1px solid #eee; border-radius: 15px; margin-bottom: 20px; }
        .input-card label { display: block; font-size: 13px; color: #666; margin-bottom: 5px; margin-left: 5px; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 15px; outline-color: #4CAF50; }
        
        .button-row { display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; color: white; }
        .btn-in { background-color: #4CAF50; }
        .btn-out { background-color: #FF5252; }
        button:active { transform: scale(0.98); opacity: 0.9; }

        .list-header { font-weight: bold; padding: 10px; border-bottom: 2px solid #eee; display: flex; justify-content: space-between; color: #555; }
        .inventory-list { max-height: 400px; overflow-y: auto; }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 10px; border-bottom: 1px solid #f9f9f9; }
        .item-info .name { font-weight: bold; font-size: 16px; color: #333; }
        .item-info .barcode { font-size: 12px; color: #999; margin-top: 2px; }
        .stock-val { font-size: 18px; font-weight: bold; }
        .low-stock { color: #FF5252; }
    </style>
</head>
<body>

<div class="app-container">
    <h1>ğŸ¾ í«ìƒµ ì¬ê³  ê´€ë¦¬</h1>

    <div class="input-card">
        <label>ë°”ì½”ë“œ ë²ˆí˜¸</label>
        <input type="text" id="barcodeInput" placeholder="ë°”ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        
        <label>ìƒí’ˆëª… (ì‹ ê·œ ë“±ë¡ì‹œì—ë§Œ ì…ë ¥)</label>
        <input type="text" id="nameInput" placeholder="ì˜ˆ: ê³ ì–‘ì´ ì¸„ë¥´">
        
        <div class="button-row">
            <button class="btn-in" onclick="handleStock('IN')">ì…ê³  (+)</button>
            <button class="btn-out" onclick="handleStock('OUT')">ì¶œê³  (-)</button>
        </div>
    </div>

    <div class="list-header">
        <span>ìƒí’ˆ ì •ë³´</span>
        <span>í˜„ì¬ ì¬ê³ </span>
    </div>
    <div id="inventory-display" class="inventory-list">
        </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // ------------------------------------------------------------------
    // [ì¤‘ìš”] ì•„ë˜ firebaseConfig ë‚´ìš©ì„ ë³¸ì¸ì˜ ì •ë³´ë¡œ ë°˜ë“œì‹œ êµì²´í•˜ì„¸ìš”!
    // ------------------------------------------------------------------
    const firebaseConfig = {
        apiKey: "AIzaSy...",
        authDomain: "your-project.firebaseapp.com",
        databaseURL: "https://your-project.firebaseio.com",
        projectId: "your-project",
        storageBucket: "your-project.appspot.com",
        messagingSenderId: "123456789",
        appId: "1:123456789:web:..."
    };

    // Firebase ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 1. ì‹¤ì‹œê°„ ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    const display = document.getElementById('inventory-display');
    onValue(ref(db, 'products/'), (snapshot) => {
        const data = snapshot.val();
        display.innerHTML = ''; 
        
        if (data) {
            for (let id in data) {
                const item = data[id];
                const row = document.createElement('div');
                row.className = 'item-row';
                row.innerHTML = `
                    <div class="item-info">
                        <div class="name">${item.name}</div>
                        <div class="barcode">${id}</div>
                    </div>
                    <div class="stock-val ${item.quantity < 5 ? 'low-stock' : ''}">${item.quantity}ê°œ</div>
                `;
                display.appendChild(row);
            }
        } else {
            display.innerHTML = '<p style="text-align:center; color:#ccc; margin-top:20px;">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        }
    });

    // 2. ì…ì¶œê³  ë²„íŠ¼ ë¡œì§
    window.handleStock = function(mode) {
        const bCode = document.getElementById('barcodeInput').value.trim();
        const pName = document.getElementById('nameInput').value.trim();

        if (!bCode) {
            alert("ë°”ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        const productRef = ref(db, 'products/' + bCode);

        runTransaction(productRef, (currentData) => {
            if (currentData === null) {
                // ì‹ ê·œ ë“±ë¡ ë¡œì§
                if (!pName) {
                    alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒí’ˆëª…ì„ ì…ë ¥í•˜ê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
                    return; 
                }
                return { name: pName, quantity: 1 };
            } else {
                // ê¸°ì¡´ ìƒí’ˆ ì¦ê° ë¡œì§
                if (mode === 'IN') {
                    currentData.quantity += 1;
                } else {
                    if (currentData.quantity > 0) {
                        currentData.quantity -= 1;
                    } else {
                        alert("ì¬ê³ ê°€ ì´ë¯¸ 0ê°œì…ë‹ˆë‹¤.");
                    }
                }
                return currentData;
            }
        }).then(() => {
            // ì„±ê³µ ì‹œ ì…ë ¥ í•„ë“œ ë¹„ìš°ê¸°
            document.getElementById('barcodeInput').value = '';
            document.getElementById('nameInput').value = '';
        }).catch((err) => {
            console.error("ì˜¤ë¥˜:", err);
            alert("ë°ì´í„° ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. Firebase ê·œì¹™ì„ í™•ì¸í•˜ì„¸ìš”.");
        });
    };
</script>

</body>
</html>